# Reference
This document list all API reference and guide you on how to use Steer.

# Contents
- [What is Steer](#what-is-steer)
- [The guide](#the-guide)
    - [Dependencies](#dependencies)
- [Packages](#packages)
- [OAuth2](#oauth2)

# What is Steer
Steer is a URL creator for OAuth2 and Drive for Google APIs as mentioned [here](https://github.com/fernando-gap/steer#steer). What Steer **does not** actually do is make a **HTTP request**, and create other types of OAuth2 URLs other than *Desktop & Mobile Apps*.

# Packages
The Steer API has two packages oauth and drive which provides useful modules to handle Google API URLs.

To import the main packages:
```python
import steer.oauth.api as oauth
import steer.drive.upload as drive
```

Where oauth is the package, and the class OAuth2 is provided by the `api` module. The Drive package contains the drive modules.

Steer also provides some extra modules to use with OAuth2 that is:
```python
import steer.oauth.challenge as challenge
import steer.oauth.response as response
```

Where challenge is the `code_challenge` generated by you and used by Google to increase the security levels of a desktop app, Steer provides full support to this. 

The response module is to handle the response after the code exchange. It has two purposes: to get the `refresh_token` and `access_token` and to check whether the `access_token` is expired after some time i. e. given by google.

# OAuth2
The module of OAuth2 is where all the URL creation process happens. It should be enough to create an application.

## OAuth2 class
Before dive in the OAuth2 is necessary to understand how google uses it, and which type of fields is needed to create the OAuth2 URL. The following fields of authentication is noticeable:

- client_id
- scope
- response_type
- redirect_uri
- client_secret

The class OAuth2 can load these fields using a *json*, a *dictionary*, or passing *keywords* arguments to the instance.

config.json
```json
{
    "client_id": "your_client_id",
    "scope": "authorization_scope",
    "response_type": "code",
    "redirect_uri": "http://localhost:port"
}
```
The `redirect_uri` is the Loopback IP address which is provided by you in the moment of the URL creation.
The `response_type` for **desktop** is set up for `code`, Steer only supports authentication for *Desktop apps*.

```python
# json
auth = OAuth2(json_path="./config.json")

# dictionary
config = {
    "client_id": "your_client_id",
    "scope": "authorization_scope",
    "response_type": "code",
    "redirect_uri": "http://localhost:port"
}

auth = OAuth2(dict_params="./config.json")

# keyword arguments
auth = OAuth2(client_id="your_client_id",
              scope="authorization_scope",
              response_type="code",
              redirect_uri="http://localhost:port"
              )
```

The application example uses the `config.json` as configuration. 

## OAuth2 Methods
### OAuth2.create(challenge=None)
The `create` method is the **first** thing you invoke if you want to authenticate the user, it creates the OAuth2 URL for your application. The method can optionally uses a `code_challenge`. The method return the respective URL if you want to store in a variable.

Arguments:
- challenge - The challenge is a `code_challenge` created for every request, and sent to the authorization url to get the access token.

#### Example
The first thing in our example app is to add the OAuth2 authentication and create an OAuth2 URL.

```python
# app.py
from steer.oauth.api import OAuth2

oauth = OAuth2(json_path='./config.json')
oauth.create()
```

### OAuth2.open()
Google does not let you open the request using a *http client*. The method opens the default user's browser to start the OAuth2 request, the only part of steer that *actually* sends a *request*.

#### Example
Open the default browser of the client in our example.
```python
oauth.open()
```

The user should authorize the application to access its drive to tell Google to send the authorization code to our `Loopback IP address`.

<!-- OAuth2 package continuation -->
### OAuth2.accesstoken(code, secret=None)
The code received is needed to use in the code exchange which is the second needed thing to do to get the access token.

Arguments:
- code - The code is given by Google after the user gives access to the application
- secret - the client_secret (optional if you use in 'config.json')

#### Example
To exchange the code for an `access_token` and a `refresh_token`
```python
code_url = oauth.accesstoken(code)
```

After the code exchange is ready it is necessary to create a `POST` request to obtain the `access_token` and `refresh_token`.
At the end of our example file put this.
```python
import requests

response = requests.post(code_url)
tokens = response.json()
```
The `tokens` is a response in json format including the `access_token`, `refresh_token`, and `expires_in` properties.
